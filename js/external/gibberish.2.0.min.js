function AudioFileRequest(a,b){this.url=a,("undefined"==typeof b||null==b)&&(b=!0),this.async=b;var c=a.split(".");this.extension=c[c.length-1].toLowerCase()}function Decoder(){}function WAVDecoder(){}function AIFFDecoder(){}function createInput(){navigator.webkitGetUserMedia({audio:!0},function(a){console.log("CONNECTING INPUT"),Gibberish.mediaStreamSource=Gibberish.context.createMediaStreamSource(a),Gibberish.mediaStreamSource.connect(Gibberish.node),_hasInput=!0})}Gibberish={memo:{},codeblock:[],analysisCodeblock:[],analysisUgens:[],dirtied:[],id:0,isDirty:!1,out:null,debug:!1,callback:"",audioFiles:{},sequencers:[],callbackArgs:["input"],callbackObjects:[],analysisCallbackArgs:[],analysisCallbackObjects:[],createCallback:function(){this.memo={},this.codeblock.length=0,this.callbackArgs.length=0,this.callbackObjects.length=0,this.analysisCallbackArgs.length=0,this.dirtied.length=0,this.codestring="Gibberish.callback = function(input,",this.memo={},this.out.codegen();var a=this.codeblock.slice(0);if(this.analysisUgens.length>0){this.analysisCodeblock.length=0;for(var b=0;b<this.analysisUgens.length;b++)this.analysisCallbackArgs.push(this.analysisUgens[b].analysisSymbol)}for(var b=0;b<this.callbackArgs.length;b++)this.codestring+=this.callbackArgs[b],b<this.callbackArgs.length-1&&(this.codestring+=", ");for(var b=0;b<this.analysisCallbackArgs.length;b++)this.codestring+=", ",this.codestring+=this.analysisCallbackArgs[b];if(this.codestring+="){\n	",this.codestring+=a.join("	"),this.codestring+="\n	",this.analysisUgens.length>0){this.analysisCodeblock.length=0;for(var b=0;b<this.analysisUgens.length;b++)this.codeblock.length=0,this.analysisUgens[b].analysisCodegen();this.codestring+=this.analysisCodeblock.join("\n	"),this.codestring+="\n	"}return this.codestring+="return "+this.out.variable+";\n",this.codestring+="}",this.callbackString=this.codestring,this.debug&&console.log(this.callbackString),this.codestring},audioProcess:function(e){var bufferL=e.outputBuffer.getChannelData(0),bufferR=e.outputBuffer.getChannelData(1),input=e.inputBuffer.getChannelData(0),me=Gibberish,callback=me.callback,sequencers=me.sequencers,out=Gibberish.out.callback,objs=me.callbackObjects.slice(0),_callback;objs.unshift(0);for(var i=0,_bl=e.outputBuffer.length;_bl>i;i++){for(var j=0;j<sequencers.length;j++)sequencers[j].tick();if(me.isDirty){_callback=me.createCallback();try{callback=eval(_callback)}catch(e){console.error("ERROR WITH CALLBACK : \n\n",_callback)}me.isDirty=!1,objs=me.callbackObjects.slice(0),objs.unshift(0)}objs[0]=input[i],val=callback.apply(null,objs),bufferL[i]=val[0],bufferR[i]=val[1]}},audioProcessFirefox:function(soundData){var me=Gibberish,callback=me.callback,sequencers=me.sequencers,objs=me.callbackObjects.slice(0);objs.unshift(0);for(var i=0,size=soundData.length;size>i;i+=2){for(var j=0;j<sequencers.length;j++)sequencers[j].tick();if(me.isDirty){callback=me.createCallback();try{callback=eval(callback)}catch(e){console.error("ERROR WITH CALLBACK : \n\n",callback)}me.isDirty=!1,objs=me.callbackObjects.slice(0),objs.unshift(0)}var val=callback.apply(null,objs);soundData[i]=val[0],soundData[i+1]=val[1]}},clear:function(){this.out.inputs.length=0,this.analysisUgens.length=0,this.sequencers.length=0,this.callbackArgs.length=2,this.callbackObjects.length=1,Gibberish.dirty(this.out)},dirty:function(a){if("undefined"!=typeof a){for(var b=!1,c=0;c<this.dirtied.length;c++)this.dirtied[c].variable===a.variable&&(b=!0);b||(this.isDirty=!0,this.dirtied.push(a))}else this.isDirty=!0},generateSymbol:function(a){return a+"_"+this.id++},AudioDataDestination:function(a,b){var c=new Audio;c.mozSetup(2,a);var g,d=0,e=a/2,f=null;setInterval(function(){var a;if(f){if(a=c.mozWriteAudio(f.subarray(g)),d+=a,g+=a,g<f.length)return;f=null}var h=c.mozCurrentSampleOffset(),i=h+e-d;if(i>0){var j=new Float32Array(i);b(j),a=c.mozWriteAudio(j),h=c.mozCurrentSampleOffset(),a<j.length&&(f=j,g=a),d+=a}},100)},init:function(){Gibberish.out=new Gibberish.Bus2,Gibberish.out.codegen(),Gibberish.dirty(Gibberish.out);var a="undefined"==typeof arguments[0]?1024:arguments[0];return start=function(){if(-1===navigator.userAgent.indexOf("Firefox")){if(document.getElementsByTagName("body")[0].removeEventListener("touchstart",start),Gibberish.context=new webkitAudioContext,Gibberish.node=Gibberish.context.createJavaScriptNode(a,2,2,Gibberish.context.sampleRate),Gibberish.node.onaudioprocess=Gibberish.audioProcess,Gibberish.node.connect(Gibberish.context.destination),"ontouchstart"in document.documentElement){var b=Gibberish.context.createBufferSource();b.connect(Gibberish.context.destination),b.noteOn(0)}}else Gibberish.AudioDataDestination(44100,Gibberish.audioProcessFirefox),Gibberish.context={sampleRate:44100}},"ontouchstart"in document.documentElement?document.getElementsByTagName("body")[0].addEventListener("touchstart",start):start(),this},makePanner:function(){var a=Math.sin,b=Math.cos,c=Math.sqrt(2)/2,d=function(d,e,f){var g="object"==typeof d,h=g?d[0]:d,i=g?d[1]:d;return f[0]=h*c*(b(e)-a(e)),f[1]=i*c*(b(e)+a(e)),f};return d},defineUgenProperty:function(a,b,c){var d=c.properties[a]={value:b,binops:[],parent:c,name:a};Object.defineProperty(c,a,{configurable:!0,get:function(){return d.value},set:function(a){d.value=a,Gibberish.dirty(c)}})},polyInit:function(a){a.mod=a.polyMod,a.removeMod=a.removePolyMod;for(var b in a.polyProperties)!function(b){var c=a.polyProperties[b];Object.defineProperty(a,b,{configurable:!0,get:function(){return c},set:function(d){c=d;for(var e=0;e<a.children.length;e++)a.children[e][b]=c}})}(b)},interpolate:function(a,b){var c=0|b,d=c+1>a.length-1?0:c+1;return frac=b-c,a[c]+frac*(a[d]-a[c])},pushUnique:function(a,b){for(var c=a,d=!0,e=0;e<b.length;e++)if(c===b[e]){d=!1;break}d&&b.push(c)},"export":function(a,b){for(var c in Gibberish[a])b[c]=Gibberish[a][c]},ugen:function(){Gibberish.extend(this,{processProperties:function(){if("object"!=typeof arguments[0][0]||"undefined"!=typeof arguments[0][0].type||Array.isArray(arguments[0][0])||"op"===arguments[0][0].name){var d=0;for(var c in this.properties)"object"==typeof this.properties[c]&&"undefined"!=typeof this.properties[c].binops?"undefined"!=typeof arguments[0][d]&&(this.properties[c].value=arguments[0][d++]):"undefined"!=typeof arguments[0][d]&&(this.properties[c]=arguments[0][d++])}else{var b=arguments[0][0];for(var c in b)"undefined"!=typeof b[c]&&("object"==typeof this.properties[c]&&"undefined"!=typeof this.properties[c].binops?this.properties[c].value=b[c]:this[c]=b[c])}return this},codegen:function(){var a="",b=null;if(Gibberish.memo[this.symbol])return Gibberish.memo[this.symbol];b=this.variable?this.variable:Gibberish.generateSymbol("v"),Gibberish.memo[this.symbol]=b,this.variable=b,a+="var "+b+" = "+this.symbol+"(";for(var d in this.properties){var e=this.properties[d],f="";if(Array.isArray(e.value)){0===e.value.length&&(f=0);for(var g=0;g<e.value.length;g++){var h=e.value[g];f+="object"==typeof h?null!==h?h.codegen():"null":"function"==typeof e.value?e.value():e.value,f+=g<e.value.length-1?", ":""}}else"object"==typeof e.value?null!==e.value&&(f=e.value.codegen?e.value.codegen():e.value):"undefined"!==e.name&&(f="function"==typeof e.value?e.value():e.value);if(0!=e.binops.length){for(var i=0;i<e.binops.length;i++)a+="(";for(var j=0;j<e.binops.length;j++){var l,k=e.binops[j];l="number"==typeof k.ugen?k.ugen:null!==k.ugen?k.ugen.codegen():"null","="===k.binop?(a=a.replace(f,""),a+=l):"++"===k.binop?a+=" + Math.abs("+l+")":(0===j&&(a+=f),a+=" "+k.binop+" "+l+")")}}else a+=f;a+=", "}return" "===a.charAt(a.length-1)&&(a=a.slice(0,-2)),a+=");\n",this.codeblock=a,-1===Gibberish.codeblock.indexOf(this.codeblock)&&Gibberish.codeblock.push(this.codeblock),-1===Gibberish.callbackArgs.indexOf(this.symbol)&&"op"!==this.name&&Gibberish.callbackArgs.push(this.symbol),-1===Gibberish.callbackObjects.indexOf(this.callback)&&"op"!==this.name&&Gibberish.callbackObjects.push(this.callback),this.dirty=!1,b},init:function(){if(this.initalized||(this.symbol=Gibberish.generateSymbol(this.name),this.codeblock=null,this.variable=null),"undefined"==typeof this.properties&&(this.properties={}),!this.initialized){this.destinations=[];for(var a in this.properties)Gibberish.defineUgenProperty(a,this.properties[a],this)}if(arguments.length>0&&"object"==typeof arguments[0][0]&&"undefined"===arguments[0][0].type){var b=arguments[0][0];for(var a in b)this[a]=b[a]}return this.initialized=!0,this},mod:function(a,b,c){var d=this.properties[a],e={ugen:b,binop:c};d.binops.push(e),Gibberish.dirty(this)},removeMod:function(a,b){if("undefined"==typeof b)this.properties[a].binops.length=0;else if("number"==typeof b)this.properties[a].binops.splice(b,1);else if("object"==typeof b)for(var c=0,d=this.properties[a].binops.length;d>c;c++)this.properties[a].binops[c].ugen===b&&this.properties[a].binops.splice(c,1);Gibberish.dirty(this)},polyMod:function(a,b,c){for(var d=0;d<this.children.length;d++)this.children[d].mod(a,b,c);Gibberish.dirty(this)},removePolyMod:function(){var a=Array.prototype.slice.call(arguments,0);if("amp"!==arguments[0]&&"pan"!==arguments[0])for(var b=0;b<this.children.length;b++)this.children[b].removeMod.apply(this.children[b],a);else this.removeMod.apply(this,a);Gibberish.dirty(this)},smooth:function(a){var c=new Gibberish.OnePole;this.mod(a,c,"=")},connect:function(a){return"undefined"==typeof a&&(a=Gibberish.out),-1===this.destinations.indexOf(a)&&(a.addConnection(this,1),this.destinations.push(a)),this},send:function(a,b){return-1===this.destinations.indexOf(a)?(a.addConnection(this,b),this.destinations.push(a)):a.adjustSendAmount(this,b),this},disconnect:function(a,b){var c;if(a)c=this.destinations.indexOf(a),c>-1&&this.destinations.splice(c,1),a.removeConnection(this);else{for(var d=0;d<this.destinations.length;d++)this.destinations[d].removeConnection(this);this.destinations=[]}return Gibberish.dirty(this),this}})}},Array2=function(){this.length=0},Array2.prototype=[],Array2.prototype.remove=function(a,b){if(b="undefined"==typeof b?!0:b,"undefined"==typeof a){for(var c=0;c<this.length;c++)delete this[c];this.length=0}else if("number"==typeof a)this.splice(a,1);else if("string"==typeof a){for(var d=[],c=0;c<this.length;c++){var e=this[c];if(e.type===a||e.name===a){if(!b)return this.splice(c,1),void 0;d.push(c)}}for(var c=0;c<d.length;c++)this.splice(d[c],1)}else if("object"==typeof a)for(var f=this.indexOf(a);f>-1;)this.splice(f,1),f=this.indexOf(a);this.parent&&Gibberish.dirty(this.parent)},Array2.prototype.get=function(a){if("number"==typeof a)return this[a];if("string"==typeof a)for(var b=0;b<this.length;b++){var c=this[b];if(c.name===a)return c}else if("object"==typeof a){var d=this.indexOf(a);if(d>-1)return this[d]}return null},Array2.prototype.replace=function(a,b){if(b.parent=this,b.input=a.input,"number"!=typeof a){var c=this.indexOf(a);c>-1&&this.splice(c,1,b)}else this.splice(a,1,b);this.parent&&Gibberish.dirty(this.parent)},Array2.prototype.insert=function(a,b){if(a.parent=this,this.input=this.parent,Array.isArray(a))for(var c=0;c<a.length;c++)this.splice(b+c,0,a[c]);else this.splice(b,0,a);this.parent&&Gibberish.dirty(this.parent)},Array2.prototype.add=function(){for(var a=0;a<arguments.length;a++)arguments[a].parent=this,arguments[a].input=this.parent,this.push(arguments[a]);this.parent&&(console.log("DIRTYING"),Gibberish.dirty(this.parent))};var rnd=Math.random;Gibberish.rndf=function(a,b,c,d){if(d="undefined"==typeof d?!0:d,"undefined"==typeof c&&"object"!=typeof a){1==arguments.length?(a=0,b=arguments[0]):2==arguments.length?(a=arguments[0],b=arguments[1]):(a=0,b=1);var e=b-a,f=rnd(),g=e*f;return a+g}var h=[],i=[];"undefined"==typeof c&&(c=b||a.length);for(var j=0;c>j;j++){var k;if("object"==typeof arguments[0])k=arguments[0][randomi(0,arguments[0].length-1)];else if(d)k=Gibberish.rndf(a,b);else{for(k=Gibberish.rndf(a,b);i.indexOf(k)>-1;)k=Gibberish.rndf(a,b);i.push(k)}h.push(k)}return h},Gibberish.Rndf=function(){var a,b,c,f,d=Math.random;return Math.round,0===arguments.length?(a=0,b=1):1===arguments.length?(a=0,b=arguments[0]):2===arguments.length?(a=arguments[0],b=arguments[1]):(a=arguments[0],b=arguments[1],c=arguments[2]),f=b-a,function(){var b;if("undefined"==typeof c)b=a+d()*f;else{b=[];for(var e=0;c>e;e++)b.push(a+d()*f)}return b}},Gibberish.rndi=function(){var a,b;return 0===arguments.length?(a=0,b=1):1===arguments.length?(a=0,b=arguments[0]):(a=arguments[0],b=arguments[1]),Math.round(a+Math.random()*b)},Gibberish.Rndi=function(){var a,b,c,d=Math.random,e=Math.round;return 0===arguments.length?(a=0,b=1):1===arguments.length?(a=0,b=arguments[0]):2===arguments.length?(a=arguments[0],b=arguments[1]):(a=arguments[0],b=arguments[1],c=arguments[2]),function(){var f;if("undefined"==typeof c)f=e(a+d()*b);else{f=[];for(var g=0;c>g;g++)f.push(e(a+d()*b))}return f}},Gibberish.extend=function(a,b){for(var c in b)c.split("."),b[c]instanceof Array&&b[c].length<100?(a[c]=b[c].slice(0),"fx"===c&&(a[c].parent=b[c].parent)):"object"!=typeof b[c]||null===b[c]||b[c]instanceof Float32Array?a[c]=b[c]:(a[c]=a[c]||{},arguments.callee(a[c],b[c]));return a},Function.prototype.clone=function(){return eval("["+this.toString()+"]")[0]},String.prototype.format=function(a,b,c){function d(){var d=this,e=arguments.length+1;for(a=0;e>a;c=arguments[a++])b=c,d=d.replace(RegExp("\\{"+(a-1)+"\\}","g"),b);return d}return d.native=String.prototype.format,d}(),Gibberish.future=function(a,b){var c=new Gibberish.Sequencer({values:[function(){},function(){a(),c.stop(),c.disconnect()}],durations:[b]}).start()},Gibberish.Proxy=function(){var a=0;Gibberish.extend(this,{name:"proxy",type:"effect",properties:{},callback:function(){return a}}).init(),this.input=arguments[0],a=this.input.parent[this.input.name],delete this.input.parent[this.input.name],this.input.parent.properties[this.input.name].value=this,Object.defineProperty(this.input.parent,this.input.name,{get:function(){return a},set:function(b){a=b}}),Gibberish.dirty(this.input.parent)},Gibberish.Proxy.prototype=new Gibberish.ugen,Gibberish.Proxy2=function(){var a=arguments[0],b=arguments[1];Gibberish.extend(this,{name:"proxy2",type:"effect",properties:{},callback:function(){var c=a[b];return Array.isArray(c)?(c[0]+c[1]+c[2])/3:c}}).init(),this.getInput=function(){return a},this.setInput=function(b){a=b},this.getName=function(){return b},this.setName=function(a){b=a}},Gibberish.Proxy2.prototype=new Gibberish.ugen,Gibberish.Proxy3=function(){var a=arguments[0],b=arguments[1];Gibberish.extend(this,{name:"proxy3",type:"effect",properties:{},callback:function(){var c=a[b];return c||0}}),this.init(),this.codegen=function(){console.log(" CALLED "),this.variable||(this.variable=Gibberish.generateSymbol("v")),Gibberish.callbackArgs.push(this.symbol),Gibberish.callbackObjects.push(this.callback),this.codeblock="var "+this.variable+" = "+this.symbol+"("+a.properties[b].codegen()+");\n"}},Gibberish.Proxy3.prototype=new Gibberish.ugen,Gibberish.oscillator=function(){this.type="oscillator",this.oscillatorInit=function(){return this.fx=new Array2,this.fx.parent=this,this}},Gibberish.oscillator.prototype=new Gibberish.ugen,Gibberish._oscillator=new Gibberish.oscillator,Gibberish.Wavetable=function(){var a=0,b=null,c=Gibberish.context.sampleRate/1024;this.properties={frequency:440,amp:.25},this.getTable=function(){return b},this.setTable=function(a){b=a},this.callback=function(d,e){var f,g,h,i,j;for(a+=d/c;a>=1024;)a-=1024;return f=0|a,g=a-f,f=1023&f,h=1023===f?0:f+1,i=b[f],j=b[h],(i+g*(j-i))*e}},Gibberish.Wavetable.prototype=Gibberish._oscillator,Gibberish.asmSine=function(a,b,c){"use asm";function i(){for(var a=1024,b=1024;a=0|a-1;)b-=1,f[a>>2]=+d(6.2848*+(b/1024));h=44100/1024}function j(a,b,c){a=+a,b=+b,c=+c;var d=0,i=0,j=0,k=0,l=0,m=0;return e=+(e+a/h),e>=1024&&(e=+(e-1024)),d=+g(e),k=e-d,i=~~d,j=1024==(0|i)?0:0|i+1,l=+f[i>>2],m=+f[j>>2],+((l+k*(m-l))*b)}function k(a){return a=0|a,+f[a>>2]}var d=a.Math.sin,e=0,f=new a.Float32Array(c),g=a.Math.floor,h=0;return{init:i,gen:j,get:k}},Gibberish.asmSine2=function(){this.properties={frequency:440,amp:.5,sr:Gibberish.context.sampleRate},this.name="sine";var a=new ArrayBuffer(4096),b=Gibberish.asmSine(window,null,a);return b.init(),this.getTable=function(){return a},this.get=b.get,this.callback=b.gen,this.init(),this.oscillatorInit(),this.processProperties(arguments),this},Gibberish.asmSine2.prototype=Gibberish._oscillator,Gibberish.Sine=function(){this.__proto__=new Gibberish.Wavetable,this.name="sine";for(var a=2*Math.PI,b=new Float32Array(1024),c=1024;c--;)b[c]=Math.sin(c/1024*a);this.setTable(b),this.init(arguments),this.oscillatorInit(),this.processProperties(arguments)},Gibberish.Sine2=function(){this.__proto__=new Gibberish.Sine,this.name="sine2",this.defineUgenProperty("pan",0);var a=this.__proto__.callback,b=Gibberish.makePanner(),c=[0,0];this.callback=function(d,e,f){var g=a(d,e);return c=b(g,f,c)},this.init(),this.oscillatorInit(),this.processProperties(arguments)},Gibberish.Square=function(){this.__proto__=new Gibberish.Wavetable,this.name="square";for(var b=(2*Math.PI,new Float32Array(1024)),c=1024;c--;)b[c]=c/1024>.5?1:-1;this.setTable(b),this.init(arguments),this.oscillatorInit(),this.processProperties(arguments)},Gibberish.Saw=function(){this.__proto__=new Gibberish.Wavetable,this.name="saw";for(var a=new Float32Array(1024),b=1024;b--;)a[b]=4*((b/1024/2+.25)%.5-.25);this.setTable(a),this.init(arguments),this.oscillatorInit(),this.processProperties(arguments)},Gibberish.Saw2=function(){this.__proto__=new Gibberish.Saw,this.name="saw2",this.defineUgenProperty("pan",0);var a=this.__proto__.callback,b=Gibberish.makePanner(),c=[0,0];this.callback=function(d,e,f){var g=a(d,e);return c=b(g,f,c)},this.init()},Gibberish.Triangle=function(){this.__proto__=new Gibberish.Wavetable,this.name="triangle";for(var a=new Float32Array(1024),b=Math.abs,c=1024;c--;)a[c]=1-4*b((c/1024+.25)%1-.5);this.setTable(a),this.init(arguments),this.oscillatorInit(),this.processProperties(arguments)},Gibberish.Triangle2=function(){this.__proto__=new Gibberish.Triangle,this.name="triangle2",this.defineUgenProperty("pan",0);var a=this.__proto__.callback,b=Gibberish.makePanner(),c=[0,0];this.callback=function(d,e,f){var g=a(d,e);return b(g,f,c)},this.init(),this.oscillatorInit(),this.processProperties(arguments)},Gibberish.Saw3=function(){var a=0,b=0,c=2.5,d=-1.5,e=0,f=Math.sin,g=11;pi_2=2*Math.PI,sr=Gibberish.context.sampleRate,Gibberish.extend(this,{name:"saw",properties:{frequency:440,amp:.15,sr:Gibberish.context.sampleRate},callback:function(h){var j=h/sr,k=.5-j,l=g*k*k*k*k,m=.376-.752*j,n=1-2*j,o=0;return b+=j,b-=b>1?2:0,a=.5*(a+f(pi_2*(b+a*l))),o=c*a+d*e,e=a,o+=m,o*n}}),Object.defineProperty(this,"scale",{get:function(){return g},set:function(a){g=a}}),this.init(),this.oscillatorInit(),this.processProperties(arguments)},Gibberish.Saw3.prototype=Gibberish._oscillator,Gibberish.PWM=function(){var a=0,b=0,c=0,d=0,e=0,f=2.5,g=-1.5,i=Math.sin,j=11;pi_2=2*Math.PI,test=0,sr=Gibberish.context.sampleRate,Gibberish.extend(this,{name:"pwm",properties:{frequency:440,amp:.15,pulsewidth:.05,sr:Gibberish.context.sampleRate},callback:function(h,k,l){var m=h/sr,n=.5-m,o=j*n*n*n*n,q=1-2*m,r=0;return e+=m,e-=e>1?2:0,a=.5*(a+i(pi_2*(e+a*o))),b=.5*(b+i(pi_2*(e+b*o+l))),r=b-a,r=f*r+g*(c-d),c=a,d=b,r*q*k}}),Object.defineProperty(this,"scale",{get:function(){return j},set:function(a){j=a}}),this.init(),this.oscillatorInit(),this.processProperties(arguments)},Gibberish.PWM.prototype=Gibberish._oscillator,Gibberish.Noise=function(){var a=Math.random;Gibberish.extend(this,{name:"noise",properties:{amp:1},callback:function(b){return(2*a()-1)*b}}),this.init(),this.oscillatorInit(),this.processProperties(arguments)},Gibberish.Noise.prototype=Gibberish._oscillator,Gibberish.KarplusStrong=function(){var b=[0],c=0,d=Math.random,e=Gibberish.makePanner(),f=Gibberish.context.sampleRate,g=[0,0];Gibberish.extend(this,{name:"karplus_strong",frequency:0,properties:{blend:1,damping:0,amp:1,channels:2,pan:0},note:function(a){var c=Math.floor(f/a);b.length=0;for(var e=0;c>e;e++)b[e]=2*d()-1;this.frequency=a},callback:function(a,f,h,i,j){var k=b.shift(),l=d()>a?-1:1;f=f>0?f:0;var m=l*(k+c)*(.5-f/100);return c=m,b.push(m),m*=h,1===i?m:e(m,j,g)}}).init().oscillatorInit().processProperties(arguments)},Gibberish.KarplusStrong.prototype=Gibberish._oscillator,Gibberish.PolyKarplusStrong=function(){this.__proto__=new Gibberish.Bus2,Gibberish.extend(this,{name:"poly_karplus_strong",maxVoices:5,voiceCount:0,polyProperties:{blend:1,damping:0},note:function(a,b){var c=this.children[this.voiceCount++];this.voiceCount>=this.maxVoices&&(this.voiceCount=0),c.note(a,b)}}),this.amp=1/this.maxVoices,Gibberish.polyInit(this),this.children=[],"object"==typeof arguments[0]&&(this.maxVoices=arguments[0].maxVoices?arguments[0].maxVoices:this.maxVoices);for(var a=0;a<this.maxVoices;a++){var b={blend:this.blend,damping:this.damping,channels:2,amp:1},c=new Gibberish.KarplusStrong(b).connect(this);this.children.push(c)}this.processProperties(arguments),this.initialized=!1,Gibberish._synth.oscillatorInit.call(this),Gibberish.dirty(this)},Gibberish.bus=function(){this.type="bus",this.inputCodegen=function(){var a=this.value.codegen(),b=1===this.amp?a:a+" * "+this.amp;return this.codeblock=b,b},this.addConnection=function(){var a={value:arguments[0],amp:arguments[1],codegen:this.inputCodegen};this.inputs.push(a),Gibberish.dirty(this)},this.removeConnection=function(a){for(var b=0;b<this.inputs.length;b++)if(this.inputs[b].value===a){this.inputs.splice(b,1),Gibberish.dirty(this);break}},this.adjustSendAmount=function(a,b){for(var c=0;c<this.inputs.length;c++)if(this.inputs[c].value===a){this.inputs[c].amp=b,Gibberish.dirty(this);break}},this.callback=function(){var a=arguments[arguments.length-2],b=arguments[arguments.length-1];output[0]=output[1]=0;for(var c=0;c<arguments.length-2;c++){var d="object"==typeof arguments[c];output[0]+=d?arguments[c][0]:arguments[c],output[1]+=d?arguments[c][1]:arguments[c]}return output[0]*=a,output[1]*=a,panner(output,b,output)}},Gibberish.bus.prototype=new Gibberish.ugen,Gibberish._bus=new Gibberish.bus,Gibberish.Bus=function(){return Gibberish.extend(this,{name:"bus",properties:{inputs:[],amp:1},callback:function(){for(var a=0,b=arguments.length-1,c=arguments[b],d=0;b>d;d++)a+=arguments[d];return a*=c}}),this.init(),this.processProperties(arguments),this},Gibberish.Bus.prototype=Gibberish._bus,Gibberish.Bus2=function(){this.name="bus2",this.type="bus",this.properties={inputs:[],amp:1,pan:0};var a=[0,0],b=Gibberish.makePanner();this.callback=function(){var c=arguments,d=c.length,e=c[d-2],f=c[d-1];a[0]=a[1]=0;for(var g=0,h=d-2;h>g;g++){var i="object"==typeof c[g];a[0]+=i?c[g][0]||0:c[g]||0,a[1]+=i?c[g][1]||0:c[g]||0}return a[0]*=e,a[1]*=e,b(a,f,a)},this.show=function(){console.log(a,args)},this.getOutput=function(){return a},this.getArgs=function(){return args},this.init(arguments),this.processProperties(arguments)},Gibberish.Bus2.prototype=Gibberish._bus,Gibberish.envelope=function(){this.type="envelope"},Gibberish.envelope.prototype=new Gibberish.ugen,Gibberish._envelope=new Gibberish.envelope,Gibberish.ExponentialDecay=function(){var a=Math.pow,b=0,c=0;Gibberish.extend(this,{name:"ExponentialDecay",properties:{decay:.5,length:11050},callback:function(d,e){return b=a(d,c),c+=1/e,b},trigger:function(){c="number"==typeof arguments[0]?arguments[0]:0}}).init()},Gibberish.ExponentialDecay.prototype=Gibberish._envelope,Gibberish.Line=function(a,b,c,d){var e={name:"line",properties:{start:a||0,end:isNaN(b)?1:b,time:c||Gibberish.context.sampleRate,loops:d||!1}},f=0,g=(b-a)/c;return this.callback=function(a,b,c,d){var e=c>f?a+f++*g:b;return f=e>=b&&d?0:f,e},Gibberish.extend(this,e),this.init(),this},Gibberish.Line.prototype=Gibberish._envelope,Gibberish.AD=function(a,b){var c=0,d=0;Gibberish.extend(this,{name:"AD",properties:{attack:a||1e4,decay:b||1e4},run:function(){return d=0,c=0,this},callback:function(a,b){if(a=0>a?22050:a,b=0>b?22050:b,0===d){var e=1/a;c+=e,c>=1&&d++}else if(1===d){var e=1/b;c-=e,0>=c&&(c=0,d++)}return c},getState:function(){return d}}).init().processProperties(arguments)},Gibberish.AD.prototype=Gibberish._envelope,Gibberish.ADSR=function(a,b,c,d,e,f,g){var h={name:"adsr",type:"envelope",requireReleaseTrigger:"undefined"!=typeof g?g:!1,properties:{attack:isNaN(a)?1e4:a,decay:isNaN(b)?1e4:b,sustain:isNaN(c)?22050:c,release:isNaN(d)?1e4:d,attackLevel:e||1,sustainLevel:f||.5,releaseTrigger:0},run:function(){this.setPhase(0),this.setState(0)},stop:function(){this.releaseTrigger=1}};Gibberish.extend(this,h);var i=0,j=0,k=this;return this.callback=function(a,b,c,d,e,f,g){var h=0;return 0===j?(h=i/a*e,1===++i/a&&(j++,i=b)):1===j?(h=i/b*(e-f)+f,--i<=0&&(null!==c?(j+=1,i=c):(j+=2,i=d))):2===j?(h=f,k.requireReleaseTrigger&&g?(j++,i=d,k.releaseTrigger=0):0!==i--||k.requireReleaseTrigger||(j++,i=d)):3===j&&(i--,h=i/d*f,0>=i&&j++),h},this.call=function(){return this.callback(this.attack,this.decay,this.sustain,this.release,this.attackLevel,this.sustainLevel,this.releaseTrigger)},this.setPhase=function(a){i=a},this.setState=function(a){j=a,i=0},this.getState=function(){return j},this.init(),this},Gibberish.ADSR.prototype=Gibberish._envelope,Gibberish.ADR=function(a,b,c,d,e){var f={name:"adr",type:"envelope",properties:{attack:isNaN(a)?11025:a,decay:isNaN(b)?11025:b,release:isNaN(c)?22050:c,attackLevel:d||1,releaseLevel:e||.2},run:function(){this.setPhase(0),this.setState(0)}};Gibberish.extend(this,f);var g=0,h=0;return this.callback=function(a,b,c,d,e){var f=0;return 0===h?(f=g/a*d,1===++g/a&&(h++,g=b)):1===h?(f=g/b*(d-e)+e,--g<=0&&(h+=1,g=c)):2===h&&(g--,f=g/c*e,0>=g&&h++),f},this.setPhase=function(a){g=a},this.setState=function(a){h=a,g=0},this.getState=function(){return h},this.init(),this},Gibberish.ADR.prototype=Gibberish._envelope,Gibberish.analysis=function(){this.type="analysis",this.codegen=function(){if(Gibberish.memo[this.symbol])return Gibberish.memo[this.symbol];var a=this.variable?this.variable:Gibberish.generateSymbol("v");return Gibberish.memo[this.symbol]=a,this.variable=a,Gibberish.callbackArgs.push(this.symbol),Gibberish.callbackObjects.push(this.callback),this.codeblock="var "+this.variable+" = "+this.symbol+"();\n",-1===Gibberish.codeblock.indexOf(this.codeblock)&&Gibberish.codeblock.push(this.codeblock),this.variable},this.analysisCodegen=function(){var a=0;this.input.codegen?(a=this.input.codegen(),a.indexOf("op")>-1&&console.log("ANALYSIS BUG")):a=this.input.value?"undefined"!=typeof this.input.value.codegen?this.input.value.codegen():this.input.value:"null";var b=this.analysisSymbol+"("+a+",";for(var c in this.properties)"input"!==c&&(b+=this[c]+",");return b=b.slice(0,-1),b+=");",this.analysisCodeblock=b,-1===Gibberish.analysisCodeblock.indexOf(this.analysisCodeblock)&&Gibberish.analysisCodeblock.push(this.analysisCodeblock),-1===Gibberish.callbackObjects.indexOf(this.analysisCallback)&&Gibberish.callbackObjects.push(this.analysisCallback),b},this.remove=function(){Gibberish.analysisUgens.splice(Gibberish.analysisUgens.indexOf(this),1)},this.analysisInit=function(){this.analysisSymbol=Gibberish.generateSymbol(this.name),Gibberish.analysisUgens.push(this),Gibberish.dirty()}},Gibberish.analysis.prototype=new Gibberish.ugen,Gibberish._analysis=new Gibberish.analysis,Gibberish.Follow=function(){this.name="follow",this.properties={input:0,bufferSize:4410,mult:1};var a=Math.abs,b=[0],c=0,d=0,e=0;this.analysisCallback=function(f,g,h){"object"==typeof f&&(f=f[0]+f[1]),c+=a(f),c-=b[d],b[d]=a(f),d=(d+1)%g,b[d]=b[d]?b[d]:0,e=c/g*h},this.callback=this.getValue=function(){return e},Object.defineProperty(this,"value",{configurable:!0,get:function(){return e},set:function(a){e=a}}),this.init(),this.analysisInit(),this.processProperties(arguments)},Gibberish.Follow.prototype=Gibberish._analysis,Gibberish.SingleSampleDelay=function(){this.name="single_sample_delay",this.properties={input:arguments[0]||0,amp:arguments[1]||1};var a=0;this.analysisCallback=function(b){a=b},this.callback=function(){return a},this.getValue=function(){return a},this.init(),this.analysisInit(),this.processProperties(arguments)},Gibberish.SingleSampleDelay.prototype=Gibberish._analysis,Gibberish.Record=function(a,b,c){var d=new Float32Array(b),e=0,f=!1,g=this;Gibberish.extend(this,{name:"record",oncomplete:c,properties:{input:0,size:b||0},analysisCallback:function(a,b){f&&(d[e++]="object"==typeof a?a[0]+a[1]:a,e>=b&&(f=!1,g.remove()))},record:function(){return e=0,f=!0,this},getBuffer:function(){return d},getPhase:function(){return e},remove:function(){"undefined"!=typeof this.oncomplete&&this.oncomplete();for(var a=0;a<Gibberish.analysisUgens.length;a++){var b=Gibberish.analysisUgens[a];if(b===this)return Gibberish.callbackArgs.indexOf(this.analysisSymbol)>-1&&Gibberish.callbackArgs.splice(Gibberish.callbackArgs.indexOf(this.analysisSymbol),1),Gibberish.callbackObjects.indexOf(this.analysisCallback)>-1&&Gibberish.callbackObjects.splice(Gibberish.callbackObjects.indexOf(this.analysisCallback),1),Gibberish.analysisUgens.splice(a,1),void 0}}}),this.properties.input=a,this.init(),this.analysisInit(),Gibberish.dirty()},Gibberish.Record.prototype=Gibberish._analysis,Gibberish.effect=function(){this.type="effect"},Gibberish.effect.prototype=new Gibberish.ugen,Gibberish._effect=new Gibberish.effect,Gibberish.Distortion=function(){var a=Math.abs,b=Math.log,c=Math.LN2;Gibberish.extend(this,{name:"distortion",properties:{input:0,amount:50},callback:function(d,e){var f;return e=e>2?e:2,"number"==typeof d?(f=d*e,d=f/(1+a(f))/(b(e)/c)):(f=d[0]*e,d[0]=f/(1+a(f))/(b(e)/c),f=d[1]*e,d[1]=f/(1+a(f))/(b(e)/c)),d}}).init().processProperties(arguments)},Gibberish.Distortion.prototype=Gibberish._effect,Gibberish.Delay=function(){var a=[],b=0;a.push(new Float32Array(2*Gibberish.context.sampleRate)),a.push(new Float32Array(2*Gibberish.context.sampleRate)),Gibberish.extend(this,{name:"delay",properties:{input:0,time:22050,feedback:.5},callback:function(c,d,e){var f="number"==typeof c?1:2,g=b++%88200,h=(g+(0|d))%88200;return 1===f?(a[0][h]=(c+a[0][g])*e,c+=a[0][g]):(a[0][h]=(c[0]+a[0][g])*e,c[0]+=a[0][g],a[1][h]=(c[1]+a[1][g])*e,c[1]+=a[1][g]),c}});var c=Math.round(this.properties.time);Object.defineProperty(this,"time",{configurable:!0,get:function(){return c},set:function(a){c=Math.round(a),Gibberish.dirty(this)}}),this.init(),this.processProperties(arguments)},Gibberish.Delay.prototype=Gibberish._effect,Gibberish.Decimator=function(){var a=0,b=[],c=Math.pow,d=Math.floor;Gibberish.extend(this,{name:"decimator",properties:{input:0,bitDepth:16,sampleRate:1},callback:function(e,f,g){a+=g;var h="number"==typeof e?1:2;if(1===h){if(a>=1){var i=c(f,2);b[0]=d(e*i)/i,a-=1}e=b[0]}else{if(a>=1){var i=c(f,2);b[0]=d(e[0]*i)/i,b[1]=d(e[1]*i)/i,a-=1}e=b}return e}}).init().processProperties(arguments)},Gibberish.Decimator.prototype=Gibberish._effect,Gibberish.RingModulation=function(){var a=(new Gibberish.Sine).callback,b=[0,0];Gibberish.extend(this,{name:"ringmod",properties:{input:0,frequency:440,amp:.5,mix:.5},callback:function(c,d,e,f){var g="number"==typeof c?1:2,h=1===g?c:c[0],i=a(d,e);if(h=h*(1-f)+h*i*f,2===g){var j=c[1];return j=j*(1-f)+j*i*f,b[0]=h,b[1]=j,b}return h}}).init().processProperties(arguments)},Gibberish.RingModulation.prototype=Gibberish._effect,Gibberish.OnePole=function(){var a=0;Gibberish.extend(this,{name:"onepole",type:"effect",properties:{input:0,a0:.15,b1:.85},callback:function(b,c,d){var e=b*c+a*d;return a=e,e},smooth:function(b,c){this.input=c[b],a=this.input,c[b]=this,this.obj=c,this.property=b,this.oldSetter=c.__lookupSetter__(b),this.oldGetter=c.__lookupGetter__(b);var d=this;Object.defineProperty(c,b,{get:function(){return d.input},set:function(a){d.input=a}})},remove:function(){Object.defineProperty(this.obj,this.property,{get:this.oldGetter,set:this.oldSetter}),this.obj[this.property]=this.input}}).init().processProperties(arguments)},Gibberish.OnePole.prototype=Gibberish._effect,Gibberish.Filter24=function(){var a=[0,0,0,0],b=[0,0,0,0],c=[0,0],e=isNaN(arguments[0])?.1:arguments[0],f=isNaN(arguments[1])?3:arguments[1];
_isLowPass="undefined"!=typeof arguments[2]?arguments[2]:!0,Gibberish.extend(this,{name:"filter24",properties:{input:0,cutoff:e,resonance:f,isLowPass:_isLowPass},callback:function(d,e,f,g){var h="number"==typeof d?1:2,i=1===h?d:d[0],j=a[3]*f;if(j=j>1?1:j,e=0>e?0:e,e=e>1?1:e,i-=j,a[0]=a[0]+(-a[0]+i)*e,a[1]=a[1]+(-a[1]+a[0])*e,a[2]=a[2]+(-a[2]+a[1])*e,a[3]=a[3]+(-a[3]+a[2])*e,i=g?a[3]:i-a[3],2===h){var k=d[1];return j=b[3]*f,j=j>1?1:j,k-=j,b[0]=b[0]+(-b[0]+k)*e,b[1]=b[1]+(-b[1]+b[0])*e,b[2]=b[2]+(-b[2]+b[1])*e,b[3]=b[3]+(-b[3]+b[2])*e,k=g?b[3]:k-b[3],c[0]=i,c[1]=k,c}return i}}).init().processProperties(arguments)},Gibberish.Filter24.prototype=Gibberish._effect,Gibberish.SVF=function(){var a=[0,0],b=[0,0],c=Math.PI,d=[0,0];Gibberish.extend(this,{name:"SVF",properties:{input:0,cutoff:440,Q:2,mode:0,sr:Gibberish.context.sampleRate},callback:function(e,f,g,h,i){var j="number"==typeof e?1:2,k=1===j?e:e[0],l=2*c*f/i;g=1/g;var m=b[0]+l*a[0],n=k-m-g*a[0],o=l*n+a[0],p=n+m;if(a[0]=o,b[0]=m,k=0===h?m:1===h?n:2===h?o:p,2===j){var q=e[1],m=b[1]+l*a[1],n=q-m-g*a[1],o=l*n+a[1],p=n+m;a[1]=o,b[1]=m,q=0===h?m:1===h?n:2===h?o:p,d[0]=k,d[1]=q}else d=k;return d}}).init().processProperties(arguments)},Gibberish.SVF.prototype=Gibberish._effect,Gibberish.Biquad=function(){var e=x2=y1=y2=0,f=[0,0],g=.001639,h=.003278,i=.001639,j=-1.955777,k=.960601,l="LP",m=2e3,n=.5,o=Gibberish.context.sampleRate;Gibberish.extend(this,{name:"biquad",properties:{input:null},calculateCoefficients:function(){switch(l){case"LP":var a=2*Math.PI*m/o,b=Math.sin(a),c=Math.cos(a),d=b/(2*n);g=(1-c)/2,h=1-c,i=g,a0=1+d,j=-2*c,k=1-d;break;case"HP":var a=2*Math.PI*m/o,b=Math.sin(a),c=Math.cos(a),d=b/(2*n);g=(1+c)/2,h=-(1+c),i=g,a0=1+d,j=-2*c,k=1-d;break;case"BP":var a=2*Math.PI*m/o,b=Math.sin(a),c=Math.cos(a),e=Math.log(2)/2*n*a/b,d=b*(Math.exp(e)-Math.exp(-e))/2;g=d,h=0,i=-d,a0=1+d,j=-2*c,k=1-d;break;default:return}g/=a0,h/=a0,i/=a0,j/=a0,k/=a0},callback:function(a){var b="number"==typeof a?1:2,c=0,d=0,l=1===b?a:a[0];return c=g*l+h*e+i*x2-j*y1-k*y2,x2=e,e=a,y2=y1,y1=c,2===b&&(inR=a[1],d=g*inR+h*e[1]+i*x2[1]-j*y1[1]-k*y2[1],x2[1]=e[1],e[1]=a[1],y2[1]=y1[1],y1[1]=d,f[0]=c,f[1]=d),1===b?c:f}}).init(),Object.defineProperties(this,{mode:{get:function(){return l},set:function(a){l=a,this.calculateCoefficients()}},cutoff:{get:function(){return m},set:function(a){m=a,this.calculateCoefficients()}},Q:{get:function(){return n},set:function(a){n=a,this.calculateCoefficients()}}}),this.processProperties(arguments),this.calculateCoefficients()},Gibberish.Biquad.prototype=Gibberish._effect,Gibberish.Flanger=function(){var a=[new Float32Array(88200),new Float32Array(88200)],b=88200,c=(new Gibberish.Sine).callback,d=Gibberish.interpolate,e=-100,f=0;Gibberish.extend(this,{name:"flanger",properties:{input:0,rate:.25,feedback:0,amount:125,offset:125},callback:function(g,h,i,j){var l="number"==typeof g?1:2,m=e+c(h,.95*j);m>b?m-=b:0>m&&(m+=b);var n=d(a[0],m);return a[0][f]=1===l?g+n*i:g[0]+n*i,2===l?(g[0]+=n,n=d(a[1],m),a[1][f]=g[1]+n*i,g[1]+=n):g+=n,++f>=b&&(f=0),++e>=b&&(e=0),g}}).init().processProperties(arguments),e=-1*this.offset},Gibberish.Flanger.prototype=Gibberish._effect,Gibberish.Vibrato=function(){var a=[new Float32Array(88200),new Float32Array(88200)],b=88200,c=(new Gibberish.Sine).callback,d=Gibberish.interpolate,e=-100,f=0;Gibberish.extend(this,{name:"vibrato",properties:{input:0,rate:5,amount:.5,offset:125},callback:function(g,h,i,j){var k="number"==typeof g?1:2,l=e+c(h,i*j-1);l>b?l-=b:0>l&&(l+=b);var m=d(a[0],l);return a[0][f]=1===k?g:g[0],2===k?(g[0]=m,m=d(a[1],l),a[1][f]=g[1],g[1]=m):g=m,++f>=b&&(f=0),++e>=b&&(e=0),g}}).init().processProperties(arguments),e=-1*this.offset},Gibberish.Vibrato.prototype=Gibberish._effect,Gibberish.BufferShuffler=function(){var a=[new Float32Array(88200),new Float32Array(88200)],b=88200,c=0,d=0,e=0,f=0,g=0,h=Math.random,j=1,k=!1,l=!1,m=!1,n=Gibberish.interpolate,o=!1,p=1,q=!1,r=Gibberish.rndf,s=[0,0];Gibberish.extend(this,{name:"buffer_shuffler",properties:{input:0,chance:.25,rate:11025,length:22050,reverseChange:.5,pitchChance:.5,pitchMin:.25,pitchMax:2,wet:1,dry:0},callback:function(i,t,u,v,w,x,y,z,A,B){var C="number"==typeof i?1:2;g?0===++f%(v-400)&&(k=!1,l=!0,j=1,f=0):(a[0][d]=1===C?i:i[0],a[1][d]=1===C?i:i[1],d++,d%=b,q=0===d?1:q,e++,0==e%u&&h()<t&&(m=h()<w,g=!0,m||(c=d-v,0>c&&(c=b+c)),o=h()<x,o&&(p=r(y,z)),j=1,k=!0,l=!1)),c+=m?-1*p:p,0>c?c+=b:c>=b&&(c-=b);var E,F,G,H,D=n(a[0],c);return k?(j-=.0025,G=D*(1-j),E=1===C?G+i*j:G+i[0]*j,2===C&&(H=n(a[1],c),G=H*(1-j),F=1===C?E:G+i[1]*j),.0025>=j&&(k=!1)):l?(j-=.0025,G=D*j,E=1===C?G+i*j:G+i[0]*(1-j),2===C&&(H=n(a[1],c),G=H*j,F=G+i[1]*(1-j)),.0025>=j&&(l=!1,g=!1,m=!1,p=1,o=0)):1===C?E=g&&q?D*A+i*B:i:(H=n(a[1],c),E=g&&q?D*A+i[0]*B:i[0],F=g&&q?H*A+i[1]*B:i[1]),s=[E,F],1===C?E:s}}).init().processProperties(arguments)},Gibberish.BufferShuffler.prototype=Gibberish._effect,Gibberish.AllPass=function(a){var c=-1,d=new Float32Array(a||500),e=d.length;Gibberish.extend(this,{name:"allpass",properties:{input:0},callback:function(a){c=++c%e;var b=d[c],f=-1*a+b;return d[c]=a+.5*b,f}})},Gibberish.Comb=function(a){var b=new Float32Array(a||1200),c=b.length,d=0,e=0;Gibberish.extend(this,{name:"comb",properties:{input:0,feedback:.84,damping:.2},callback:function(a,f,g){var h=++d%c,i=b[h];return e=i*(1-g)+e*g,b[h]=a+e*f,i}})},Gibberish.Reverb=function(){var a={combCount:8,combTuning:[1116,1188,1277,1356,1422,1491,1557,1617],allPassCount:4,allPassTuning:[556,441,341,225],allPassFeedback:.5,fixedGain:.015,scaleDamping:.4,scaleRoom:.28,offsetRoom:.7,stereoSpread:23},b=.84,c=[],d=[],e=[0,0];Gibberish.extend(this,{name:"reverb",roomSize:.5,properties:{input:0,wet:.5,dry:.55,roomSize:.84,damping:.5},callback:function(a,b,f,g,h){for(var i="object"==typeof a?2:1,j=1===i?a:a[0]+a[1],k=.015*j,l=k,m=0;8>m;m++){var n=c[m](k,.98*g,.4*h);l+=n}for(var m=0;4>m;m++)l=d[m](l);return e[0]=e[1]=j*f+l*b,e}}).init().processProperties(arguments),this.setFeedback=function(a){b=a};for(var g=0;8>g;g++)c.push(new Gibberish.Comb(a.combTuning[g]).callback);for(var g=0;4>g;g++)d.push(new Gibberish.AllPass(a.allPassTuning[g],a.allPassFeedback).callback)},Gibberish.Reverb.prototype=Gibberish._effect,Gibberish.Granulator=function(a){var b=[];buffer=null,interpolate=Gibberish.interpolate,panner=Gibberish.makePanner(),bufferLength=0,debug=0,write=0,self=this,out=[0,0],_out=[0,0],rndf=Gibberish.rndf,numberOfGrains=a.numberOfGrains||20,Gibberish.extend(this,{name:"granulator",bufferLength:88200,reverse:!0,spread:.5,properties:{speed:1,speedMin:-0,speedMax:0,grainSize:1e3,position:.5,positionMin:0,positionMax:0,amp:.2,fade:.1,pan:0,shouldWrite:!1},setBuffer:function(a){buffer=a,bufferLength=a.length},callback:function(a,c,d,e,f,g,h,i,j,k){for(var m=0;numberOfGrains>m;m++){var n=b[m];if(n._speed>0){n.pos>n.end&&(n.pos=(h+rndf(f,g))*buffer.length,n.start=n.pos,n.end=n.start+e,n._speed=a+rndf(c,d),n._speed=n._speed<.1?.1:n._speed,n._speed=n._speed<.1&&n._speed>0?.1:n._speed,n._speed=n._speed>-.1&&n._speed<0?-.1:n._speed,n.fadeAmount=n._speed*j*e,n.pan=rndf(-1*self.spread,self.spread));for(var o=n.pos;o>buffer.length;)o-=buffer.length;for(;0>o;)o+=buffer.length;var p=interpolate(buffer,o);p*=n.pos<n.fadeAmount+n.start?(n.pos-n.start)/n.fadeAmount:1,p*=n.pos>n.end-n.fadeAmount?(n.end-n.pos)/n.fadeAmount:1}else{n.pos<n.end&&(n.pos=(h+rndf(f,g))*buffer.length,n.start=n.pos,n.end=n.start-e,n._speed=a+rndf(c,d),n._speed=n._speed<.1&&n._speed>0?.1:n._speed,n._speed=n._speed>-.1&&n._speed<0?-.1:n._speed,n.fadeAmount=n._speed*j*e);for(var o=n.pos;o>buffer.length;)o-=buffer.length;for(;0>o;)o+=buffer.length;var p=interpolate(buffer,o);p*=n.pos>n.start-n.fadeAmount?(n.start-n.pos)/n.fadeAmount:1,p*=n.pos<n.end+n.fadeAmount?(n.end-n.pos)/n.fadeAmount:1}_out=panner(p*i,n.pan,_out),out[0]+=_out[0],out[1]+=_out[1],n.pos+=n._speed}return panner(out,k,out)}}).init().processProperties(arguments);for(var c=0;numberOfGrains>c;c++)b[c]={pos:self.position+Gibberish.rndf(self.positionMin,self.positionMax),_speed:self.speed+Gibberish.rndf(self.speedMin,self.speedMax)},b[c].start=b[c].pos,b[c].end=b[c].pos+self.grainSize,b[c].fadeAmount=b[c]._speed*self.fade*self.grainSize,b[c].pan=Gibberish.rndf(-1*self.spread,self.spread);"undefined"!=typeof a.buffer&&(buffer=a.buffer,bufferLength=buffer.length)},Gibberish.Granulator.prototype=Gibberish._effect,Gibberish.synth=function(){this.type="oscillator",this.oscillatorInit=function(){this.fx=new Array2,this.fx.parent=this}},Gibberish.synth.prototype=new Gibberish.ugen,Gibberish._synth=new Gibberish.synth,Gibberish.Synth=function(a){this.name="synth",this.properties={frequency:0,pulsewidth:.5,attack:22050,decay:22050,sustain:22050,release:22050,attackLevel:1,sustainLevel:.5,releaseTrigger:0,glide:.15,amp:.25,channels:2,pan:0,sr:Gibberish.context.sampleRate},this.note=function(a,d){var e=!1;if("object"!=typeof this.frequency){if(b&&a===k&&0===d)return this.releaseTrigger=1,e=!0,void 0;this.frequency=k=a}else this.frequency[0]=k=a,Gibberish.dirty(this);"undefined"==typeof d||e||(this.amp=d),c.run()},a=a||{};var b="undefined"==typeof a.useADSR?!1:a.useADSR,c=b?new Gibberish.ADSR:new Gibberish.AD,d=c.getState,e=c.callback,f=new Gibberish.PWM,g=f.callback,h=(new Gibberish.OnePole).callback,i=Gibberish.makePanner(),j=this,k=0,m=[0,0];c.requireReleaseTrigger=a.requireReleaseTrigger||!1,this.callback=function(a,c,f,k,l,n,o,p,q,r,s,t,u,v){r=r>=1?.99999:r,a=h(a,1-r,r);var w,x;return b?(w=e(f,k,l,n,o,p,q),q&&(j.releaseTrigger=0),d()<4?(x=g(a,1,c,v)*w*s,1===t?x:i(x,u,m)):(x=m[0]=m[1]=0,1===t?x:m)):d()<2?(w=e(f,k),x=g(a,1,c,v)*w*s,1===t?x:i(x,u,m)):(x=m[0]=m[1]=0,1===t?x:m)},this.getEnv=function(){return c},this.getOsc=function(){return f},this.setOsc=function(a){f=a,g=f.callback};var n="PWM";Object.defineProperty(this,"waveform",{get:function(){return n},set:function(a){this.setOsc(new Gibberish[a])}}),this.init(),this.oscillatorInit(),this.processProperties(arguments)},Gibberish.Synth.prototype=Gibberish._synth,Gibberish.PolySynth=function(){this.__proto__=new Gibberish.Bus2,Gibberish.extend(this,{name:"polysynth",maxVoices:5,voiceCount:0,frequencies:[],polyProperties:{frequency:0,glide:0,attack:22050,decay:22050,pulsewidth:.5,waveform:"PWM"},note:function(a,b){var c=this.frequencies.indexOf(a),d=c>-1?c:this.voiceCount++,e=this.children[d];e.note(a,b),this.frequencies[d]=a,this.voiceCount>=this.maxVoices&&(this.voiceCount=0)}}),this.amp=1/this.maxVoices,Gibberish.polyInit(this),this.children=[],"object"==typeof arguments[0]&&(this.maxVoices=arguments[0].maxVoices?arguments[0].maxVoices:this.maxVoices,this.useADSR="undefined"!=typeof arguments[0].useADSR?arguments[0].useADSR:!1,this.requireReleaseTrigger="undefined"!=typeof arguments[0].requireReleaseTrigger?arguments[0].requireReleaseTrigger:!1),this.dirty=!0;for(var a=0;a<this.maxVoices;a++){var b={waveform:this.waveform,attack:this.attack,decay:this.decay,pulsewidth:this.pulsewidth,channels:2,amp:1,useADSR:this.useADSR||!1,requireReleaseTrigger:this.requireReleaseTrigger||!1},c=new Gibberish.Synth(b).connect(this);this.children.push(c)}this.processProperties(arguments),Gibberish._synth.oscillatorInit.call(this)},Gibberish.Synth2=function(a){this.name="synth2",this.properties={frequency:0,pulsewidth:.5,attack:22050,decay:22050,sustain:22050,release:22050,attackLevel:1,sustainLevel:.5,releaseTrigger:0,cutoff:.25,resonance:3.5,useLowPassFilter:!0,glide:.15,amp:.25,channels:1,pan:0,sr:Gibberish.context.sampleRate},this.note=function(a,d){var e=!1;if("object"!=typeof this.frequency){if(b&&a===l&&0===d)return this.releaseTrigger=1,e=!0,void 0;this.frequency=l=a}else this.frequency[0]=l=a,Gibberish.dirty(this);"undefined"==typeof d||e||(this.amp=d),c.run()},a=a||{};var b="undefined"==typeof a.useADSR?!1:a.useADSR,c=b?new Gibberish.ADSR:new Gibberish.AD,d=c.getState,e=c.callback,f=new Gibberish.PWM,g=f.callback,h=new Gibberish.Filter24,i=h.callback,j=(new Gibberish.OnePole).callback,k=Gibberish.makePanner(),l=0,m=this,n=[0,0];c.requireReleaseTrigger=a.requireReleaseTrigger||!1,this.callback=function(a,c,f,h,l,o,p,q,r,s,t,u,v,w,x,y,z){v=v>=1?.99999:v,a=j(a,1-v,v);var A,B;return b?(A=e(f,h,l,o,p,q,r),r&&(m.releaseTrigger=0),d()<4?(B=i(g(a,.15,c,z),s*A,t,u)*A*w,1===x?B:k(B,y,n)):(B=n[0]=n[1]=0,1===x?B:n)):d()<2?(A=e(f,h),B=i(g(a,.15,c,z),s*A,t,u)*A*w,1===x?B:k(B,y,n)):(B=n[0]=n[1]=0,1===x?B:n)},this.getUseADSR=function(){return b},this.getEnv=function(){return c},this.getOsc=function(){return f},this.setOsc=function(a){f=a,g=f.callback};var o="PWM";Object.defineProperty(this,"waveform",{get:function(){return o},set:function(a){this.setOsc(new Gibberish[a])}}),this.init(),this.oscillatorInit(),this.processProperties(arguments)},Gibberish.Synth2.prototype=Gibberish._synth,Gibberish.PolySynth2=function(){this.__proto__=new Gibberish.Bus2,Gibberish.extend(this,{name:"polysynth2",maxVoices:5,voiceCount:0,frequencies:[],polyProperties:{frequency:0,glide:0,attack:22050,decay:22050,pulsewidth:.5,resonance:3.5,cutoff:.25,useLowPassFilter:!0,waveform:"PWM"},note:function(a,b){var c=this.frequencies.indexOf(a),d=c>-1?c:this.voiceCount++,e=this.children[d];e.note(a,b),this.frequencies[d]=a,this.voiceCount>=this.maxVoices&&(this.voiceCount=0)}}),this.amp=1/this.maxVoices,Gibberish.polyInit(this),this.children=[],"object"==typeof arguments[0]&&(this.maxVoices=arguments[0].maxVoices?arguments[0].maxVoices:this.maxVoices,this.useADSR="undefined"!=typeof arguments[0].useADSR?arguments[0].useADSR:!1,this.requireReleaseTrigger="undefined"!=typeof arguments[0].requireReleaseTrigger?arguments[0].requireReleaseTrigger:!1),this.dirty=!0;for(var a=0;a<this.maxVoices;a++){var b={attack:this.attack,decay:this.decay,pulsewidth:this.pulsewidth,channels:2,amp:1,useADSR:this.useADSR||!1,requireReleaseTrigger:this.requireReleaseTrigger||!1},c=new Gibberish.Synth2(b);c.connect(this),this.children.push(c)}this.processProperties(arguments),Gibberish._synth.oscillatorInit.call(this)},Gibberish.FMSynth=function(a){this.name="fmSynth",this.properties={frequency:0,cmRatio:2,index:5,attack:22050,decay:22050,sustain:22050,release:22050,attackLevel:1,sustainLevel:.5,releaseTrigger:0,glide:.15,amp:.25,channels:2,pan:0},this.note=function(a,d){var e=!1;if("object"!=typeof this.frequency){if(b&&a===l&&0===d)return this.releaseTrigger=1,e=!0,void 0;this.frequency=l=a}else this.frequency[0]=l=a,Gibberish.dirty(this);"undefined"==typeof d||e||(this.amp=d),c.run()},a=a||{};var b="undefined"==typeof a.useADSR?!1:a.useADSR,c=b?new Gibberish.ADSR:new Gibberish.AD,d=c.getState,e=c.callback,f=(new Gibberish.Sine).callback,g=(new Gibberish.Sine).callback,h=(new Gibberish.OnePole).callback,i=Gibberish.makePanner(),j=[0,0],k=this,l=0;c.requireReleaseTrigger=a.requireReleaseTrigger||!1,this.callback=function(a,c,l,m,n,o,p,q,r,s,t,u,v,w){var x,y,z;return t>=1&&(t=.9999),a=h(a,1-t,t),b?(x=e(m,n,o,p,q,r,s),s&&(k.releaseTrigger=0),d()<4?(z=g(a*c,a*l)*x,y=f(a+z,1)*x*u,1===v?y:i(y,w,j)):(y=j[0]=j[1]=0,1===v?y:j)):d()<2?(x=e(m,n),z=g(a*c,a*l)*x,y=f(a+z,1)*x*u,j[0]=j[1]=y,1===v?y:i(y,w,j)):(y=j[0]=j[1]=0,1===v?y:i(y,w,j))},this.init(),this.oscillatorInit(),this.processProperties(arguments)},Gibberish.FMSynth.prototype=Gibberish._synth,Gibberish.PolyFM=function(){this.__proto__=new Gibberish.Bus2,Gibberish.extend(this,{name:"polyfm",maxVoices:5,voiceCount:0,children:[],frequencies:[],polyProperties:{glide:0,attack:22050,decay:22050,index:5,cmRatio:2},note:function(a,b){var c=this.frequencies.indexOf(a),d=c>-1?c:this.voiceCount++,e=this.children[d];e.note(a,b),this.frequencies[d]=a,this.voiceCount>=this.maxVoices&&(this.voiceCount=0)}}),this.amp=1/this.maxVoices,Gibberish.polyInit(this),this.children=[],"object"==typeof arguments[0]&&(this.maxVoices=arguments[0].maxVoices?arguments[0].maxVoices:this.maxVoices,this.useADSR="undefined"!=typeof arguments[0].useADSR?arguments[0].useADSR:!1,this.requireReleaseTrigger="undefined"!=typeof arguments[0].requireReleaseTrigger?arguments[0].requireReleaseTrigger:!1);for(var a=0;a<this.maxVoices;a++){var b={attack:this.attack,decay:this.decay,cmRatio:this.cmRatio,index:this.index,channels:2,useADSR:this.useADSR||!1,requireReleaseTrigger:this.requireReleaseTrigger||!1,amp:1},c=new Gibberish.FMSynth(b);c.connect(this),this.children.push(c)}this.processProperties(arguments),Gibberish._synth.oscillatorInit.call(this)},AudioFileRequest.prototype.onSuccess=function(){},AudioFileRequest.prototype.onFailure=function(){},AudioFileRequest.prototype.send=function(){if("wav"!=this.extension&&"aiff"!=this.extension&&"aif"!=this.extension)return this.onFailure(),void 0;var a=new XMLHttpRequest;a.open("GET",this.url,this.async),a.overrideMimeType("text/plain; charset=x-user-defined"),a.onreadystatechange=function(){4==a.readyState&&(200==a.status||0==a.status?this.handleResponse(a.responseText):this.onFailure())}.bind(this),a.send(null)},AudioFileRequest.prototype.handleResponse=function(a){var b,c;"wav"==this.extension?(b=new WAVDecoder,c=b.decode(a)):("aiff"==this.extension||"aif"==this.extension)&&(b=new AIFFDecoder,c=b.decode(a)),this.onSuccess(c)},Decoder.prototype.readString=function(a,b,c){return a.slice(b,b+c)},Decoder.prototype.readIntL=function(a,b,c){for(var d=0,e=0;c>e;e++)d+=(255&a.charCodeAt(b+e))*Math.pow(2,8*e);return d},Decoder.prototype.readChunkHeaderL=function(a,b){var c={};return c.name=this.readString(a,b,4),c.length=this.readIntL(a,b+4,4),c},Decoder.prototype.readIntB=function(a,b,c){for(var d=0,e=0;c>e;e++)d+=(255&a.charCodeAt(b+e))*Math.pow(2,8*(c-e-1));return d},Decoder.prototype.readChunkHeaderB=function(a,b){var c={};return c.name=this.readString(a,b,4),c.length=this.readIntB(a,b+4,4),c},Decoder.prototype.readFloatB=function(a,b){var c=this.readIntB(a,b,2),d=32768;c>=d&&(c|=~(d-1));var e=1;0>c&&(e=-1,c+=d);var h,f=this.readIntB(a,b+2,4),g=this.readIntB(a,b+6,4);return 0==(c==f==g)?h=0:32767==c?h=Number.MAX_VALUE:(c-=16383,h=(4294967296*f+g)*Math.pow(2,c-63)),e*h},WAVDecoder.prototype.__proto__=Decoder.prototype,WAVDecoder.prototype.decode=function(a){var b={},c=0,d=this.readChunkHeaderL(a,c);if(c+=8,"RIFF"!=d.name)return console.error("File is not a WAV"),null;var e=d.length;e+=8;var f=this.readString(a,c,4);if(c+=4,"WAVE"!=f)return console.error("File is not a WAV"),null;for(;e>c;){var d=this.readChunkHeaderL(a,c);if(c+=8,"fmt "==d.name){var g=this.readIntL(a,c,2);if(c+=2,1!=g)return console.error("Cannot decode non-PCM encoded WAV file"),null;var h=this.readIntL(a,c,2);c+=2;var i=this.readIntL(a,c,4);c+=4,c+=4,c+=2;var j=this.readIntL(a,c,2),k=j/8;c+=2}else if("data"==d.name){for(var l=d.length/(k*h),m=[],n=0;h>n;n++)m.push(new Float32Array(l));for(var n=0;h>n;n++)for(var o=m[n],p=0;l>p;p++){var q=c;q+=(p*h+n)*k;var r=this.readIntL(a,q,k),s=1<<j-1;r>=s&&(r|=~(s-1)),o[p]=r/s}c+=d.length}else c+=d.length}return b.sampleRate=i,b.bitDepth=j,b.channels=m,b.length=l,b},AIFFDecoder.prototype.__proto__=Decoder.prototype,AIFFDecoder.prototype.decode=function(a){var b={},c=0,d=this.readChunkHeaderB(a,c);if(c+=8,"FORM"!=d.name)return console.error("File is not an AIFF"),null;var e=d.length;e+=8;var f=this.readString(a,c,4);if(c+=4,"AIFF"!=f)return console.error("File is not an AIFF"),null;for(;e>c;){var d=this.readChunkHeaderB(a,c);if(c+=8,"COMM"==d.name){var g=this.readIntB(a,c,2);c+=2;var h=this.readIntB(a,c,4);c+=4;for(var i=[],j=0;g>j;j++)i.push(new Float32Array(h));var k=this.readIntB(a,c,2),l=k/8;c+=2;var m=this.readFloatB(a,c);c+=10}else if("SSND"==d.name){var n=this.readIntB(a,c,4);c+=4,c+=4,c+=n;for(var j=0;g>j;j++)for(var o=i[j],p=0;h>p;p++){var q=c;q+=(p*g+j)*l;var r=this.readIntB(a,q,l),s=1<<k-1;r>=s&&(r|=~(s-1)),o[p]=r/s}c+=d.length-n-8}else c+=d.length}return b.sampleRate=m,b.bitDepth=k,b.channels=i,b.length=h,b},Gibberish.Sampler=function(){var a=1,b=Gibberish.interpolate,d=Gibberish.makePanner(),g=[0,0],h=null,i=1,j=this;if(Gibberish.extend(this,{name:"sampler",file:null,isLoaded:!1,playOnLoad:0,properties:{pitch:1,amp:1,isRecording:!1,isPlaying:!0,input:0,length:0,start:0,end:1,loops:0,pan:0},_onload:function(b){h=b.channels[0],i=b.length,j.end=i,j.length=a=i,j.isPlaying=!0,console.log("LOADED ",j.file,i),Gibberish.audioFiles[j.file]=h,j.onload&&j.onload(),0!==j.playOnLoad&&j.note(j.playOnLoad),j.isLoaded=!0},floatTo16BitPCM:function(a,b,c){for(var d=0;d<c.length-1;d++,b+=2){var e=Math.max(-1,Math.min(1,c[d]));a.setInt16(b,0>e?32768*e:32767*e,!0)}},encodeWAV:function(){function e(a,b,c){for(var d=0;d<c.length;d++)a.setUint8(b+d,c.charCodeAt(d))}var a=this.getBuffer(),b=new ArrayBuffer(44+2*a.length),c=new DataView(b),d=Gibberish.context.sampleRate;return e(c,0,"RIFF"),c.setUint32(4,32+2*a.length,!0),e(c,8,"WAVE"),e(c,12,"fmt "),c.setUint32(16,16,!0),c.setUint16(20,1,!0),c.setUint16(22,1,!0),c.setUint32(24,d,!0),c.setUint32(28,4*d,!0),c.setUint16(32,2,!0),c.setUint16(34,16,!0),e(c,36,"data"),c.setUint32(40,2*a.length,!0),this.floatTo16BitPCM(c,44,a),c},download:function(){var a=this.encodeWAV(),b=new Blob([a]),c=window.webkitURL.createObjectURL(b),d=window.document.createElement("a");d.href=c,d.download="output.wav";var e=document.createEvent("Event");e.initEvent("click",!0,!0),d.dispatchEvent(e)},note:function(b,c){if("number"==typeof this.pitch?this.pitch=b:"object"==typeof this.pitch&&(this.pitch[0]=b,Gibberish.dirty(this)),"number"==typeof c&&(this.amp=c),null!==this.function){this.isPlaying=!0;var d="number"==typeof this.pitch?this.pitch:this.pitch[0];a=d>0||"number"!=typeof d?this.start:this.end}},getBuffer:function(){return h},setBuffer:function(a){h=a},getPhase:function(){return a},setPhase:function(b){a=b},callback:function(c,e,f,i,j,k,l,m,n,o){var p=0;return a+=c,m>a&&a>0?(c>0?p=null!==h&&i?b(h,a):0:a>l?p=null!==h&&i?b(h,a):0:a=n?m:a,d(p*e,o,g)):(a=n&&c>0?l:a,a=n&&0>c?m:a,g[0]=g[1]=p,g)}}).init().oscillatorInit().processProperties(arguments),"undefined"!=typeof arguments[0]&&("string"==typeof arguments[0]?(console.log("SETTING FILE"),this.file=arguments[0],this.pitch=0):"object"==typeof arguments[0]&&arguments[0].file&&(this.file=arguments[0].file)),"undefined"!=typeof Gibberish.audioFiles[this.file])h=Gibberish.audioFiles[this.file],this.end=this.bufferLength=h.length,a=this.bufferLength,Gibberish.dirty(this),this.onload&&this.onload();else if(null!==this.file){var k=new AudioFileRequest(this.file);k.onSuccess=this._onload,k.send()}else"undefined"!=typeof this.buffer&&(this.isLoaded=!0,h=this.buffer,this.end=this.bufferLength=h.length||88200,a=this.bufferLength,arguments[0]&&arguments[0].loops&&(this.loops=1),Gibberish.dirty(this),this.onload&&this.onload())},Gibberish.Sampler.prototype=Gibberish._oscillator,Gibberish.Sampler.prototype.record=function(a,b){this.isRecording=!0;var c=this;return this.recorder=new Gibberish.Record(a,b,function(){c.setBuffer(this.getBuffer()),c.end=bufferLength=c.getBuffer().length,c.setPhase(c.end),c.isRecording=!1}).record(),this},Gibberish.MonoSynth=function(){Gibberish.extend(this,{name:"monosynth",properties:{attack:1e4,decay:1e4,cutoff:.2,resonance:2.5,amp1:1,amp2:1,amp3:1,filterMult:.3,isLowPass:!0,pulsewidth:.5,amp:.6,detune2:.01,detune3:-.01,octave2:1,octave3:-1,glide:0,pan:0,frequency:0,channels:1},waveform:"Saw3",note:function(a,d){"undefined"!=typeof d&&(this.amp=d),"object"!=typeof this.frequency?this.frequency=a:(this.frequency[0]=a,Gibberish.dirty(this)),c()>0&&b.run()}});var a=this.waveform;Object.defineProperty(this,"waveform",{get:function(){return a},set:function(b){a!==b&&(a=b,f=(new Gibberish[b]).callback,g=(new Gibberish[b]).callback,h=(new Gibberish[b]).callback)}});var b=new Gibberish.AD(this.attack,this.decay),c=b.getState,d=b.callback,e=(new Gibberish.Filter24).callback,f=new Gibberish[this.waveform](this.frequency,this.amp1).callback,g=new Gibberish[this.waveform](this.frequency2,this.amp2).callback,h=new Gibberish[this.waveform](this.frequency3,this.amp3).callback,i=(new Gibberish.OnePole).callback,j=Gibberish.makePanner(),k=[0,0];this.callback=function(a,b,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B){if(c()<2){y>=1&&(y=.9999),A=i(A,1-y,y);var C=A;if(w>0)for(var D=0;w>D;D++)C*=2;else if(0>w)for(var D=0;D>w;D--)C/=2;var E=A;if(x>0)for(var D=0;x>D;D++)E*=2;else if(0>x)for(var D=0;D>x;D--)E/=2;C+=u>0?(2*A-A)*u:(A-A/2)*u,E+=v>0?(2*A-A)*v:(A-A/2)*v;var F=f(A,n,s)+g(C,o,s)+h(E,p,s),G=d(a,b),H=e(F,l+q*G,m,r,1)*G;return H*=t,k[0]=k[1]=H,1===B?k:j(H,z,k)}return k[0]=k[1]=0,k},this.init(),this.oscillatorInit(),this.processProperties(arguments)},Gibberish.MonoSynth.prototype=Gibberish._synth,Gibberish.Binops={"export":function(a){Gibberish.export("Binops",a||window)},operator:function(){var a=new Gibberish.ugen,b=arguments[0],c=Array.prototype.slice.call(arguments,1);a.name="op",a.properties={};for(var d=0;d<c.length;d++)a.properties[d]=c[d];return a.init.apply(a,c),a.codegen=function(){var a,c="( ";a=Object.keys(this.properties);for(var d=0;d<a.length;d++){var e="object"==typeof this[d];c+=e?this[d].codegen():this[d],d<a.length-1&&(c+=" "+b+" ")}return c+=" )",this.codeblock=c,c},a},Add:function(){var a=Array.prototype.slice.call(arguments,0);return a.unshift("+"),Gibberish.Binops.operator.apply(null,a)},Sub:function(){var a=Array.prototype.slice.call(arguments,0);return a.unshift("-"),Gibberish.Binops.operator.apply(null,a)},Mul:function(){var a=Array.prototype.slice.call(arguments,0);return a.unshift("*"),Gibberish.Binops.operator.apply(null,a)},Div:function(){var a=Array.prototype.slice.call(arguments,0);return a.unshift("/"),Gibberish.Binops.operator.apply(null,a)},Mod:function(){var a=Array.prototype.slice.call(arguments,0);return a.unshift("%"),Gibberish.Binops.operator.apply(null,a)},Abs:function(){var b=(Array.prototype.slice.call(arguments,0),{name:"abs",properties:{},callback:Math.abs});return b.__proto__=new Gibberish.ugen,b.properties[0]=arguments[0],b.init(),b},Sqrt:function(){var b=(Array.prototype.slice.call(arguments,0),{name:"sqrt",properties:{},callback:Math.sqrt});return b.__proto__=new Gibberish.ugen,b.properties[i]=arguments[0],b.init(),b},Pow:function(){var a=Array.prototype.slice.call(arguments,0),b={name:"pow",properties:{},callback:Math.pow};b.__proto__=new Gibberish.ugen;for(var c=0;c<a.length;c++)b.properties[c]=a[c];return b.init(),b},Merge:function(){var a=Array.prototype.slice.call(arguments,0),b={name:"merge",properties:{},callback:function(a){return a[0]+a[1]}};b.__proto__=new Gibberish.ugen;for(var c=0;c<a.length;c++)b.properties[c]=a[c];return b.init(),b},Map:function(a,b,c,d,e,f,g){var h=Math.pow,i=0,m=0,n={name:"map",properties:{input:a,outputMin:b,outputMax:c,inputMin:d,inputMax:e,curve:f||i,wrap:g||!1},callback:function(a,b,c,d,e,f,g){var l,i=c-b,j=e-d,k=(a-d)/j;return k>1?k=g?k%1:1:0>k&&(k=g?1+k%1:0),l=0===f?b+k*i:b+h(k,1.5)*i,m=l,l},getValue:function(){return m}};return n.__proto__=new Gibberish.ugen,n.init(),n}},Gibberish.Time={bpm:120,"export":function(a){Gibberish.export("Time",a||window)},ms:function(a){return a*Gibberish.context.sampleRate/1e3},seconds:function(a){return a*Gibberish.context.sampleRate},beats:function(a){return function(){var b=Gibberish.context.sampleRate/(Gibberish.Time.bpm/60);return b*a}}},Gibberish.Sequencer2=function(){var a=this,b=0;Gibberish.extend(this,{target:null,key:null,values:null,valuesIndex:0,durations:null,durationsIndex:0,nextTime:0,playOnce:!1,repeatCount:0,repeatTarget:null,isConnected:!0,keysAndValues:null,counts:{},properties:{rate:1,isRunning:!1,nextTime:0},offset:0,name:"seq",callback:function(c,d,e){if(d){if(b>=e){if(null!==a.values){if(a.target){var f=a.values[a.valuesIndex++];if("function"==typeof f)try{f=f()}catch(g){console.error("ERROR: Can't execute function triggered by Sequencer:\n"+f.toString()),a.values.splice(a.valuesIndex-1,1),a.valuesIndex--}"function"==typeof a.target[a.key]?a.target[a.key](f):a.target[a.key]=f}else if("function"==typeof a.values[a.valuesIndex])try{a.values[a.valuesIndex++]()}catch(g){console.error("ERROR: Can't execute function triggered by Sequencer:\n"+a.values[a.valuesIndex-1].toString()),a.values.splice(a.valuesIndex-1,1),a.valuesIndex--}a.valuesIndex>=a.values.length&&(a.valuesIndex=0)}else if(null!==a.keysAndValues)for(var h in a.keysAndValues){var i="function"==typeof a.keysAndValues[h].pick?a.keysAndValues[h].pick():a.counts[h]++,f=a.keysAndValues[h][i];if("function"==typeof f)try{f=f()}catch(g){console.error("ERROR: Can't execute function triggered by Sequencer:\n"+f.toString()),a.keysAndValues[h].splice(i,1),"function"!=typeof a.keysAndValues[h].pick&&a.counts[h]--}"function"==typeof a.target[h]?a.target[h](f):a.target[h]=f,a.chose&&a.chose(h,i),a.counts[h]>=a.keysAndValues[h].length&&(a.counts[h]=0,a.repeatTarget&&(a.repeatCount++,a.repeatCount===a.repeatTarget&&(a.isRunning=!1,a.repeatCount=0)))}else"function"==typeof a.target[a.key]&&a.target[a.key]();if(b-=e,Array.isArray(a.durations)){var j="function"==typeof a.durations.pick?a.durations.pick():a.durationsIndex++,k=a.durations[j];a.nextTime="function"==typeof k?k():k,a.chose&&a.chose("durations",j),a.durationsIndex>=a.durations.length&&(a.durationsIndex=0)}else{var k=a.durations;a.nextTime="function"==typeof k?k():k}return a.repeatTarget&&(a.repeatCount++,a.repeatCount===a.repeatTarget&&(a.isRunning=!1,a.repeatCount=0)),0}b+=c}return 0},start:function(a){return a||(b=0),this.isRunning=!0,this},stop:function(){return this.isRunning=!1,this},repeat:function(a){return this.repeatTarget=a,this},shuffle:function(){for(c in this.keysAndValues)this.shuffleArray(this.keysAndValues[c])},shuffleArray:function(a){for(var b,c,d=a.length;d;b=parseInt(Math.random()*d),c=a[--d],a[d]=a[b],a[b]=c);}}),this.init(arguments),this.processProperties(arguments);for(var c in this.keysAndValues)this.counts[c]=0;this.oscillatorInit(),b+=this.offset,this.connect()},Gibberish.Sequencer2.prototype=Gibberish._oscillator,Gibberish.Sequencer=function(){Gibberish.extend(this,{target:null,key:null,values:null,valuesIndex:0,durations:null,durationsIndex:0,nextTime:0,phase:0,isRunning:!1,playOnce:!1,repeatCount:0,repeatTarget:null,isConnected:!0,keysAndValues:null,counts:{},offset:0,name:"seq",tick:function(){if(this.isRunning){if(this.phase>=this.nextTime){if(null!==this.values){if(this.target){var a=this.values[this.valuesIndex++];if("function"==typeof a)try{a=a()}catch(b){console.error("ERROR: Can't execute function triggered by Sequencer:\n"+a.toString()),this.values.splice(this.valuesIndex-1,1),this.valuesIndex--}"function"==typeof this.target[this.key]?this.target[this.key](a):this.target[this.key]=a}else if("function"==typeof this.values[this.valuesIndex])try{this.values[this.valuesIndex++]()}catch(b){console.error("ERROR: Can't execute function triggered by Sequencer:\n"+this.values[this.valuesIndex-1].toString()),this.values.splice(this.valuesIndex-1,1),this.valuesIndex--}this.valuesIndex>=this.values.length&&(this.valuesIndex=0)}else if(null!==this.keysAndValues)for(var c in this.keysAndValues){var d="function"==typeof this.keysAndValues[c].pick?this.keysAndValues[c].pick():this.counts[c]++,a=this.keysAndValues[c][d];if("function"==typeof a)try{a=a()}catch(b){console.error("ERROR: Can't execute function triggered by Sequencer:\n"+a.toString()),this.keysAndValues[c].splice(d,1),"function"!=typeof this.keysAndValues[c].pick&&this.counts[c]--}"function"==typeof this.target[c]?this.target[c](a):this.target[c]=a,this.counts[c]>=this.keysAndValues[c].length&&(this.counts[c]=0)}else"function"==typeof this.target[this.key]&&this.target[this.key]();if(this.phase-=this.nextTime,Array.isArray(this.durations)){var e="function"==typeof this.durations.pick?this.durations[this.durations.pick()]:this.durations[this.durationsIndex++];this.nextTime="function"==typeof e?e():e,this.durationsIndex>=this.durations.length&&(this.durationsIndex=0)}else{var e=this.durations;this.nextTime="function"==typeof e?e():e}return this.repeatTarget&&(this.repeatCount++,this.repeatCount===this.repeatTarget&&(this.isRunning=!1,this.repeatCount=0)),void 0}this.phase++}},start:function(a){return a||(this.phase=this.offset),this.isRunning=!0,this},stop:function(){return this.isRunning=!1,this},repeat:function(a){return this.repeatTarget=a,this
},shuffle:function(){for(a in this.keysAndValues)this.shuffleArray(this.keysAndValues[a])},shuffleArray:function(a){for(var b,c,d=a.length;d;b=parseInt(Math.random()*d),c=a[--d],a[d]=a[b],a[b]=c);},disconnect:function(){var a=Gibberish.sequencers.indexOf(this);Gibberish.sequencers.splice(a,1),this.isConnected=!1},connect:function(){return-1===Gibberish.sequencers.indexOf(this)&&Gibberish.sequencers.push(this),this.isConnected=!0,this}});for(var a in arguments[0])this[a]=arguments[0][a];for(var a in this.keysAndValues)this.counts[a]=0;this.connect(),this.phase+=this.offset},Gibberish.Sequencer.prototype=Gibberish._oscillator;var _hasInput=!1;Gibberish.Input=function(){var a=[];_hasInput||createInput(),this.type=this.name="input",this.fx=new Array2,this.fx.parent=this,this.properties={input:"input",amp:.5,channels:1},this.callback=function(b,c,d){return 1===d?a=b*c:(a[0]=b[0]*c,a[1]=b[1]*c),a},this.init(arguments),this.processProperties(arguments)},Gibberish.Input.prototype=new Gibberish.ugen,Gibberish.Kick=function(){var a=!1,b=(new Gibberish.SVF).callback,c=(new Gibberish.SVF).callback,d=.2,e=.8;Gibberish.extend(this,{name:"kick",properties:{pitch:50,__decay:20,__tone:1e3,amp:2,sr:Gibberish.context.sampleRate},callback:function(d,e,f,g,h){var i=a?60:0;return i=b(i,d,e,2,h),i=c(i,f,.5,0,h),i*=g,a=!1,i},note:function(b,c,d,e){"number"==typeof b&&(this.pitch=b),"number"==typeof c&&(this.decay=c),"number"==typeof d&&(this.tone=d),"number"==typeof e&&(this.amp=e),a=!0}}).init().oscillatorInit(),Object.defineProperties(this,{decay:{get:function(){return d},set:function(a){d=a>1?1:a,this.__decay=100*d}},tone:{get:function(){return e},set:function(a){e=a>1?1:a,this.__tone=220+1400*a}}}),this.processProperties(arguments)},Gibberish.Kick.prototype=Gibberish._oscillator,Gibberish.Conga=function(){var a=!1,b=(new Gibberish.SVF).callback;Gibberish.extend(this,{name:"conga",properties:{pitch:190,amp:2,sr:Gibberish.context.sampleRate},callback:function(c,d,e){var f=a?60:0;return f=b(f,c,50,2,e),f*=d,a=!1,f},note:function(b,c){"number"==typeof b&&(this.pitch=b),"number"==typeof c&&(this.amp=c),a=!0}}).init().oscillatorInit(),this.processProperties(arguments)},Gibberish.Conga.prototype=Gibberish._oscillator,Gibberish.Clave=function(){var a=!1,b=new Gibberish.SVF,c=b.callback;Gibberish.extend(this,{name:"clave",properties:{pitch:2500,amp:1,sr:Gibberish.context.sampleRate},callback:function(b,d,e){var f=a?2:0;return f=c(f,b,5,2,e),f*=d,a=!1,f},note:function(b,c){"number"==typeof b&&(this.pitch=b),"number"==typeof c&&(this.amp=c),a=!0}}).init().oscillatorInit(),this.bpf=b,this.processProperties(arguments)},Gibberish.Clave.prototype=Gibberish._oscillator,Gibberish.Tom=function(){var a=!1,b=(new Gibberish.SVF).callback,c=(new Gibberish.SVF).callback,d=new Gibberish.ExponentialDecay,e=d.callback,f=Math.random;Gibberish.extend(this,{name:"tom",properties:{pitch:80,amp:.5,sr:Gibberish.context.sampleRate},callback:function(d,g,h){var j,i=a?60:0;return i=b(i,d,30,2,h),j=16*f()-8,j=j>0?j:0,j*=e(.05,11025),j=c(j,120,.5,0,h),i+=j,i*=g,a=!1,i},note:function(b,c){"number"==typeof b&&(this.pitch=b),"number"==typeof c&&(this.amp=c),d.trigger(),a=!0}}).init().oscillatorInit(),d.trigger(1),this.processProperties(arguments)},Gibberish.Tom.prototype=Gibberish._oscillator,Gibberish.Cowbell=function(){var a=new Gibberish.Square,b=new Gibberish.Square,c=a.callback,d=b.callback,e=new Gibberish.SVF({mode:2}),f=e.callback,g=new Gibberish.ExponentialDecay(.0025,10500),h=g.callback;Gibberish.extend(this,{name:"cowbell",properties:{amp:1,pitch:560,bpfFreq:1e3,bpfRez:3,decay:22050,decayCoeff:1e-4,sr:Gibberish.context.sampleRate},callback:function(a,b,e,g,i,j,k){var l;return l=c(b,1,1,0),l+=d(845,1,1,0),l=f(l,e,g,2,k),l*=h(j,i),l*=a},note:function(a){g.trigger(),a&&(this.decay=a)}}).init().oscillatorInit().processProperties(arguments),this.bpf=e,this.eg=g,g.trigger(1)},Gibberish.Cowbell.prototype=Gibberish._oscillator,Gibberish.Snare=function(){var a=(new Gibberish.SVF).callback,b=(new Gibberish.SVF).callback,c=(new Gibberish.SVF).callback,d=new Gibberish.ExponentialDecay(.0025,11025),e=d.callback,f=Math.random,i=0;Gibberish.extend(this,{name:"snare",properties:{cutoff:1e3,decay:11025,tune:0,snappy:.5,amp:1,sr:Gibberish.context.sampleRate},callback:function(d,g,h,j,k,l){var m,n,p=0,q=0;return p=e(.0025,g),p>.005&&(q=(2*f()-1)*p,q=c(q,d+1e3*h,.5,1,l),q*=j,q=q>0?q:0,i=p,m=a(i,180*(h+1),15,2,l),n=b(i,330*(h+1),15,2,l),q+=m,q+=.8*n,q*=k),q},note:function(a,b,c,e){"number"==typeof a&&(this.tune=a),"number"==typeof e&&(this.cutoff=e),"number"==typeof c&&(this.snappy=c),"number"==typeof b&&(this.amp=b),d.trigger()}}).init().oscillatorInit().processProperties(arguments),d.trigger(1)},Gibberish.Snare.prototype=Gibberish._oscillator,Gibberish.Hat=function(){var a=new Gibberish.Square,b=new Gibberish.Square,c=new Gibberish.Square,d=new Gibberish.Square,e=new Gibberish.Square,f=new Gibberish.Square,g=a.callback,h=b.callback,i=c.callback,j=d.callback,k=e.callback,l=f.callback,m=new Gibberish.SVF({mode:2}),n=m.callback,o=new Gibberish.Filter24,p=o.callback,q=new Gibberish.ExponentialDecay(.0025,10500),r=q.callback,s=new Gibberish.ExponentialDecay(.1,7500);s.callback,Gibberish.extend(this,{name:"hat",properties:{amp:1,pitch:325,bpfFreq:7e3,bpfRez:2,hpfFreq:.975,hpfRez:0,decay:3500,decay2:3e3,sr:Gibberish.context.sampleRate},callback:function(a,b,c,d,e,f,m,o,q){var s;return s=g(b,1,.5,0),s+=h(1.4471*b,.75,1,0),s+=i(1.617*b,1,1,0),s+=j(1.9265*b,1,1,0),s+=k(2.5028*b,1,1,0),s+=l(2.6637*b,.75,1,0),s=n(s,c,d,2,q),s*=r(.001,m),s=p(s,e,f,0,1),s*=a},note:function(a,b){q.trigger(),s.trigger(),a&&(this.decay=a),b&&(this.decay2=b)}}).init().oscillatorInit().processProperties(arguments),this.bpf=m,this.hpf=o,q.trigger(1),s.trigger(1)},Gibberish.Hat.prototype=Gibberish._oscillator;

Gibberish.PolySeq = function() {
  var that = this,
      phase = 0;
  
  Gibberish.extend(this, {
    seqs          : [],
    timeline      : {},
    playOnce      : false,
    repeatCount   : 0,
    repeatTarget  : null,
    isConnected   : true,
    properties    : { rate: 1, isRunning:false, nextTime:0 },
    offset        : 0,
    name          : 'polyseq',
    
    callback : function(rate, isRunning, nextTime) {
      if(isRunning) {
        if(phase >= nextTime) {
              seqs = that.timeline[ nextTime ]
            
          for( var j = 0; j < seqs.length; j++ ) {
            var seq = seqs[ j ]
                      
            if( seq.target ) {
              var idx = seq.values.pick ? seq.values.pick() : seq.valuesIndex++ % seq.values.length,
                  val = seq.values[ idx ];
      
              if(typeof val === 'function') { val = val(); }
      
              if(typeof seq.target[ seq.key ] === 'function') {
                seq.target[ seq.key ]( val );
              }else{
                seq.target[ seq.key ] = val;
              }
            }else{
              if(typeof seq.values[ seq.valuesIndex ] === 'function') {
                seq.values[ seq.valuesIndex++ % seq.values.length ]();
              }
            }
              
            if( Array.isArray( seq.durations ) ) {
              var idx = seq.durations.pick ? seq.durations.pick() : seq.durationsIndex++,
                  next = seq.durations[ idx ]

              seq.nextTime = typeof next === 'function' ? next() : next;
              if( seq.durationsIndex >= seq.durations.length ) {
                seq.durationsIndex = 0;
              }
            }else{
              var next = seq.durations;
              seq.nextTime = typeof next === 'function' ? next() : next;
            }
          
            var t = Gibber.Clock.Time( seq.nextTime ) + nextTime // TODO: remove Gibber dependence
            if( typeof that.timeline[ t ] === 'undefined' ) {
              that.timeline[ t ] = [ seq ]
            }else{
              that.timeline[ t ].push( seq )
            }
          }
          
          delete that.timeline[ nextTime ]
          
          var nt = Object.keys( that.timeline )
          
          for( var i = 0; i < nt.length; i++ ) {
            nt[ i ] = parseFloat( nt[i] )
          }
          
          nt = nt.sort( function(a,b) { if( a < b ) return -1; if( a > b ) return 1; return 0; })
          
          that.nextTime = nt[0]

          
          // if(that.repeatTarget) {
          //   that.repeatCount++;
          //   if(that.repeatCount === that.repeatTarget) {
          //     that.isRunning = false;
          //     that.repeatCount = 0;
          //   }
          // }
          
          return 0;
        }
      
        phase += rate; //that.rate;
      }
      return 0;
    },
  
    start : function(shouldKeepOffset) {
      if(!shouldKeepOffset) {
        phase = 0;
      }
      
      this.isRunning = true;
      return this;
    },
    
    stop: function() {
      this.isRunning = false;
      return this;
    },
       
    repeat : function(times) {
      this.repeatTarget = times;
      return this;
    },
    
    shuffle : function() {
      for( key in this.keysAndValues ) {
        this.shuffleArray( this.keysAndValues[ key ] )
      }
    },
    
    shuffleArray : function( arr ) {
  		for(var j, x, i = arr.length; i; j = parseInt(Math.random() * i), x = arr[--i], arr[i] = arr[j], arr[j] = x);
    },

  });
  
  this.init( arguments );
  this.processProperties( arguments );
  
  this.timeline[0] = []
  for( var i = 0; i < this.seqs.length; i++ ) {
    var _seq = this.seqs[ i ]
    
    _seq.valuesIndex = _seq.durationsIndex = 0
    
    this.timeline[0].push( _seq )
  }
  
  this.oscillatorInit();
  
  //phase += this.offset
  
  this.connect();
};
Gibberish.PolySeq.prototype = Gibberish._oscillator